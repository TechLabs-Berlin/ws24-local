{"version":3,"names":["JsiNode","constructor","ctx","type","props","Skia","depMgr","setProps","setProp","name","v","hasChanged","getProps","children","_children","addChild","child","push","dispose","unsubscribeNode","forEach","removeChild","index","indexOf","node","splice","insertChildBefore","before","beforeIndex","JsiDeclarationNode","declarationType","decorateChildren","decorate","Error","invalidate","setInvalidate"],"sources":["Node.ts"],"sourcesContent":["import type { Skia } from \"../../skia/types\";\nimport type {\n  Node,\n  DeclarationNode,\n  NodeType,\n  DeclarationType,\n} from \"../types\";\nimport type { DependencyManager } from \"../../renderer/DependencyManager\";\nimport type { DeclarationContext } from \"../types/DeclarationContext\";\n\nexport interface NodeContext {\n  Skia: Skia;\n  depMgr: DependencyManager;\n}\n\nexport abstract class JsiNode<P> implements Node<P> {\n  protected _children: JsiNode<unknown>[] = [];\n  protected Skia: Skia;\n  protected depMgr: DependencyManager;\n\n  constructor(ctx: NodeContext, public type: NodeType, protected props: P) {\n    this.Skia = ctx.Skia;\n    this.depMgr = ctx.depMgr;\n  }\n\n  setProps(props: P) {\n    this.props = props;\n  }\n\n  setProp<K extends keyof P>(name: K, v: P[K]) {\n    const hasChanged = this.props[name] !== v;\n    this.props[name] = v;\n    return hasChanged;\n  }\n\n  getProps() {\n    return this.props;\n  }\n\n  children() {\n    return this._children;\n  }\n\n  addChild(child: Node<unknown>) {\n    this._children.push(child as JsiNode<unknown>);\n  }\n\n  dispose() {\n    this.depMgr.unsubscribeNode(this);\n    this._children.forEach((child) => child.dispose());\n  }\n\n  removeChild(child: Node<unknown>) {\n    const index = this._children.indexOf(child as JsiNode<unknown>);\n    if (index !== -1) {\n      const [node] = this._children.splice(index, 1);\n      node.dispose();\n    }\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>) {\n    const index = this._children.indexOf(child as JsiNode<unknown>);\n    if (index !== -1) {\n      this._children.splice(index, 1);\n    }\n    const beforeIndex = this._children.indexOf(before as JsiNode<unknown>);\n    this._children.splice(beforeIndex, 0, child as JsiNode<unknown>);\n  }\n}\n\nexport type Invalidate = () => void;\n\nexport abstract class JsiDeclarationNode<P>\n  extends JsiNode<P>\n  implements DeclarationNode<P>\n{\n  private invalidate: Invalidate = () => {};\n\n  constructor(\n    ctx: NodeContext,\n    public declarationType: DeclarationType,\n    type: NodeType,\n    props: P\n  ) {\n    super(ctx, type, props);\n  }\n\n  abstract decorate(ctx: DeclarationContext): void;\n\n  protected decorateChildren(ctx: DeclarationContext) {\n    this.children().forEach((child) => {\n      if (child instanceof JsiDeclarationNode) {\n        child.decorate(ctx);\n      }\n    });\n  }\n\n  addChild(child: Node<unknown>): void {\n    if (!(child instanceof JsiDeclarationNode)) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    super.addChild(child);\n    this.invalidate();\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>): void {\n    if (!(child instanceof JsiDeclarationNode)) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    super.insertChildBefore(child, before);\n    this.invalidate();\n  }\n\n  dispose() {\n    this.invalidate();\n    super.dispose();\n  }\n\n  setInvalidate(invalidate: Invalidate) {\n    this.invalidate = invalidate;\n  }\n\n  setProps(props: P) {\n    super.setProps(props);\n    this.invalidate();\n  }\n\n  setProp<K extends keyof P>(name: K, v: P[K]) {\n    const hasChanged = super.setProp(name, v);\n    if (hasChanged) {\n      this.invalidate();\n    }\n    return hasChanged;\n  }\n}\n"],"mappings":"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"}