{"version":3,"names":["processUniforms","FilterMode","MipmapMode","TileMode","JsiDeclarationNode","DeclarationType","NodeType","enumKey","fitRects","getRect","processGradientProps","processTransformProps","rect2rect","ShaderDeclaration","constructor","ctx","type","props","Shader","ShaderNode","decorate","decorateChildren","source","uniforms","transform","m3","Skia","Matrix","shader","makeShaderWithChildren","shaders","popAll","push","ImageShaderNode","ImageShader","fit","image","tx","ty","fm","mm","imageShaderProps","rct","rects","x","y","width","height","sx","sy","src","dst","translate","translateX","translateY","scale","scaleX","scaleY","lm","concat","makeShaderOptions","ColorNode","ColorShader","color","MakeColor","Color","TurbulenceNode","Turbulence","freqX","freqY","octaves","seed","tileWidth","tileHeight","MakeTurbulence","FractalNoiseNode","FractalNoise","MakeFractalNoise","LinearGradientNode","LinearGradient","start","end","colors","positions","mode","localMatrix","flags","MakeLinearGradient","RadialGradientNode","RadialGradient","c","r","MakeRadialGradient","SweepGradientNode","SweepGradient","MakeSweepGradient","TwoPointConicalGradientNode","TwoPointConicalGradient","startR","endR","MakeTwoPointConicalGradient"],"sources":["Shaders.ts"],"sourcesContent":["import {\n  processUniforms,\n  FilterMode,\n  MipmapMode,\n  TileMode,\n} from \"../../../skia/types\";\nimport type { NodeContext } from \"../Node\";\nimport { JsiDeclarationNode } from \"../Node\";\nimport type {\n  ColorProps,\n  DeclarationContext,\n  FractalNoiseProps,\n  ImageShaderProps,\n  LinearGradientProps,\n  RadialGradientProps,\n  ShaderProps,\n  SweepGradientProps,\n  TurbulenceProps,\n  TwoPointConicalGradientProps,\n} from \"../../types\";\nimport { DeclarationType, NodeType } from \"../../types\";\nimport {\n  enumKey,\n  fitRects,\n  getRect,\n  processGradientProps,\n  processTransformProps,\n  rect2rect,\n} from \"../datatypes\";\n\nexport abstract class ShaderDeclaration<P> extends JsiDeclarationNode<P> {\n  constructor(ctx: NodeContext, type: NodeType, props: P) {\n    super(ctx, DeclarationType.Shader, type, props);\n  }\n}\n\nexport class ShaderNode extends ShaderDeclaration<ShaderProps> {\n  constructor(ctx: NodeContext, props: ShaderProps) {\n    super(ctx, NodeType.Shader, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    this.decorateChildren(ctx);\n    const { source, uniforms, ...transform } = this.props;\n    const m3 = this.Skia.Matrix();\n    processTransformProps(m3, transform);\n    const shader = source.makeShaderWithChildren(\n      processUniforms(source, uniforms),\n      ctx.shaders.popAll(),\n      m3\n    );\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class ImageShaderNode extends ShaderDeclaration<ImageShaderProps> {\n  constructor(ctx: NodeContext, props: ImageShaderProps) {\n    super(ctx, NodeType.ImageShader, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { fit, image, tx, ty, fm, mm, ...imageShaderProps } = this.props;\n    if (!image) {\n      return;\n    }\n\n    const rct = getRect(this.Skia, imageShaderProps);\n    const m3 = this.Skia.Matrix();\n    if (rct) {\n      const rects = fitRects(\n        fit,\n        { x: 0, y: 0, width: image.width(), height: image.height() },\n        rct\n      );\n      const [x, y, sx, sy] = rect2rect(rects.src, rects.dst);\n      m3.translate(x.translateX, y.translateY);\n      m3.scale(sx.scaleX, sy.scaleY);\n    }\n    const lm = this.Skia.Matrix();\n    lm.concat(m3);\n    processTransformProps(lm, imageShaderProps);\n    const shader = image.makeShaderOptions(\n      TileMode[enumKey(tx)],\n      TileMode[enumKey(ty)],\n      FilterMode[enumKey(fm)],\n      MipmapMode[enumKey(mm)],\n      lm\n    );\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class ColorNode extends ShaderDeclaration<ColorProps> {\n  constructor(ctx: NodeContext, props: ColorProps) {\n    super(ctx, NodeType.ColorShader, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { color } = this.props;\n    const shader = this.Skia.Shader.MakeColor(this.Skia.Color(color));\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class TurbulenceNode extends ShaderDeclaration<TurbulenceProps> {\n  constructor(ctx: NodeContext, props: TurbulenceProps) {\n    super(ctx, NodeType.Turbulence, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { freqX, freqY, octaves, seed, tileWidth, tileHeight } = this.props;\n    const shader = this.Skia.Shader.MakeTurbulence(\n      freqX,\n      freqY,\n      octaves,\n      seed,\n      tileWidth,\n      tileHeight\n    );\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class FractalNoiseNode extends ShaderDeclaration<FractalNoiseProps> {\n  constructor(ctx: NodeContext, props: FractalNoiseProps) {\n    super(ctx, NodeType.FractalNoise, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { freqX, freqY, octaves, seed, tileWidth, tileHeight } = this.props;\n    const shader = this.Skia.Shader.MakeFractalNoise(\n      freqX,\n      freqY,\n      octaves,\n      seed,\n      tileWidth,\n      tileHeight\n    );\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class LinearGradientNode extends ShaderDeclaration<LinearGradientProps> {\n  constructor(ctx: NodeContext, props: LinearGradientProps) {\n    super(ctx, NodeType.LinearGradient, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { start, end } = this.props;\n    const { colors, positions, mode, localMatrix, flags } =\n      processGradientProps(this.Skia, this.props);\n    const shader = this.Skia.Shader.MakeLinearGradient(\n      start,\n      end,\n      colors,\n      positions ?? null,\n      mode,\n      localMatrix,\n      flags\n    );\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class RadialGradientNode extends ShaderDeclaration<RadialGradientProps> {\n  constructor(ctx: NodeContext, props: RadialGradientProps) {\n    super(ctx, NodeType.RadialGradient, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { c, r } = this.props;\n    const { colors, positions, mode, localMatrix, flags } =\n      processGradientProps(this.Skia, this.props);\n    const shader = this.Skia.Shader.MakeRadialGradient(\n      c,\n      r,\n      colors,\n      positions,\n      mode,\n      localMatrix,\n      flags\n    );\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class SweepGradientNode extends ShaderDeclaration<SweepGradientProps> {\n  constructor(ctx: NodeContext, props: SweepGradientProps) {\n    super(ctx, NodeType.SweepGradient, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { c, start, end } = this.props;\n    const { colors, positions, mode, localMatrix, flags } =\n      processGradientProps(this.Skia, this.props);\n    const shader = this.Skia.Shader.MakeSweepGradient(\n      c.x,\n      c.y,\n      colors,\n      positions,\n      mode,\n      localMatrix,\n      flags,\n      start,\n      end\n    );\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class TwoPointConicalGradientNode extends ShaderDeclaration<TwoPointConicalGradientProps> {\n  constructor(ctx: NodeContext, props: TwoPointConicalGradientProps) {\n    super(ctx, NodeType.TwoPointConicalGradient, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { startR, endR, start, end } = this.props;\n    const { colors, positions, mode, localMatrix, flags } =\n      processGradientProps(this.Skia, this.props);\n    const shader = this.Skia.Shader.MakeTwoPointConicalGradient(\n      start,\n      startR,\n      end,\n      endR,\n      colors,\n      positions,\n      mode,\n      localMatrix,\n      flags\n    );\n    ctx.shaders.push(shader);\n  }\n}\n"],"mappings":"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"}