{"version":3,"names":["BlurStyle","ClipOp","isRRect","DeclarationType","NodeType","JsiDeclarationNode","JsiRenderNode","inflate","Skia","box","dx","dy","tx","ty","RRectXY","XYWHRect","rect","x","y","width","height","rx","ry","deflate","BoxShadowNode","constructor","ctx","props","Unknown","BoxShadow","decorate","_ctx","materialize","BoxNode","Box","renderNode","canvas","paint","defaultBox","opacity","getAlphaf","shadows","_children","map","node","filter","n","shadow","inner","color","blur","spread","lPaint","Paint","setColor","Color","setAlphaf","setMaskFilter","MaskFilter","MakeBlur","Normal","drawRRect","delta","Point","Math","abs","save","clipRRect","Intersect","outer","drawDRRect","restore"],"sources":["Box.ts"],"sourcesContent":["import type { SkRRect, Skia } from \"../../../skia/types\";\nimport { BlurStyle, ClipOp, isRRect } from \"../../../skia/types\";\nimport type { DrawingContext } from \"../../types\";\nimport { DeclarationType, NodeType } from \"../../types\";\nimport type { BoxShadowProps, BoxProps } from \"../../types/Drawings\";\nimport type { NodeContext } from \"../Node\";\nimport { JsiDeclarationNode } from \"../Node\";\nimport { JsiRenderNode } from \"../RenderNode\";\nimport type { DeclarationContext } from \"../../types/DeclarationContext\";\n\nconst inflate = (\n  Skia: Skia,\n  box: SkRRect,\n  dx: number,\n  dy: number,\n  tx = 0,\n  ty = 0\n) =>\n  Skia.RRectXY(\n    Skia.XYWHRect(\n      box.rect.x - dx + tx,\n      box.rect.y - dy + ty,\n      box.rect.width + 2 * dx,\n      box.rect.height + 2 * dy\n    ),\n    box.rx + dx,\n    box.ry + dy\n  );\n\nconst deflate = (\n  Skia: Skia,\n  box: SkRRect,\n  dx: number,\n  dy: number,\n  tx = 0,\n  ty = 0\n) => inflate(Skia, box, -dx, -dy, tx, ty);\n\nexport class BoxShadowNode extends JsiDeclarationNode<BoxShadowProps> {\n  constructor(ctx: NodeContext, props: BoxShadowProps) {\n    super(ctx, DeclarationType.Unknown, NodeType.BoxShadow, props);\n  }\n\n  decorate(_ctx: DeclarationContext) {\n    // do nothing\n  }\n\n  materialize() {\n    return this.props;\n  }\n}\n\nexport class BoxNode extends JsiRenderNode<BoxProps> {\n  constructor(ctx: NodeContext, props: BoxProps) {\n    super(ctx, NodeType.Box, props);\n  }\n\n  renderNode({ canvas, paint }: DrawingContext) {\n    const { box: defaultBox } = this.props;\n    const opacity = paint.getAlphaf();\n    const box = isRRect(defaultBox)\n      ? defaultBox\n      : this.Skia.RRectXY(defaultBox, 0, 0);\n    const shadows = this._children\n      .map((node) => {\n        if (node instanceof BoxShadowNode) {\n          return node.materialize();\n        }\n        return null;\n      })\n      .filter((n): n is BoxShadowProps => n !== null);\n    shadows\n      .filter((shadow) => !shadow.inner)\n      .map((shadow) => {\n        const { color = \"black\", blur, spread = 0, dx = 0, dy = 0 } = shadow;\n        const lPaint = this.Skia.Paint();\n        lPaint.setColor(this.Skia.Color(color));\n        lPaint.setAlphaf(paint.getAlphaf() * opacity);\n        lPaint.setMaskFilter(\n          this.Skia.MaskFilter.MakeBlur(BlurStyle.Normal, blur, true)\n        );\n        canvas.drawRRect(\n          inflate(this.Skia, box, spread, spread, dx, dy),\n          lPaint\n        );\n      });\n\n    canvas.drawRRect(box, paint);\n\n    shadows\n      .filter((shadow) => shadow.inner)\n      .map((shadow) => {\n        const { color = \"black\", blur, spread = 0, dx = 0, dy = 0 } = shadow;\n        const delta = this.Skia.Point(10 + Math.abs(dx), 10 + Math.abs(dy));\n        canvas.save();\n        canvas.clipRRect(box, ClipOp.Intersect, false);\n        const lPaint = this.Skia.Paint();\n        lPaint.setColor(this.Skia.Color(color));\n        lPaint.setAlphaf(paint.getAlphaf() * opacity);\n\n        lPaint.setMaskFilter(\n          this.Skia.MaskFilter.MakeBlur(BlurStyle.Normal, blur, true)\n        );\n        const inner = deflate(this.Skia, box, spread, spread, dx, dy);\n        const outer = inflate(this.Skia, box, delta.x, delta.y);\n        canvas.drawDRRect(outer, inner, lPaint);\n        canvas.restore();\n      });\n  }\n}\n"],"mappings":"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"}