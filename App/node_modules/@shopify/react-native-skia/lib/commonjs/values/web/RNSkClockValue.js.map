{"version":3,"names":["RNSkClockState","RNSkClockValue","RNSkReadonlyValue","constructor","raf","NotStarted","_","_state","Running","now","Date","deltaFromStart","_start","tick","_raf","notifyUpdate","update","value","start","_stop","timeSinceStop","stop","Stopped"],"sources":["RNSkClockValue.ts"],"sourcesContent":["import type { SkiaClockValue } from \"../types\";\n\nimport { RNSkReadonlyValue } from \"./RNSkReadonlyValue\";\n\nenum RNSkClockState {\n  NotStarted = 0,\n  Running = 1,\n  Stopped = 2,\n}\n\nexport class RNSkClockValue\n  extends RNSkReadonlyValue<number>\n  implements SkiaClockValue\n{\n  constructor(raf: (callback: (time: number) => void) => number) {\n    super(0);\n    this._raf = raf;\n    this.update(0);\n  }\n\n  private _raf: (callback: (time: number) => void) => number;\n  private _start: number | undefined;\n  private _stop: number | undefined;\n  private _state: RNSkClockState = RNSkClockState.NotStarted;\n\n  private notifyUpdate = (_: number) => {\n    if (this._state === RNSkClockState.Running) {\n      const now = Date.now();\n      const deltaFromStart = now - this._start!;\n      this.tick(deltaFromStart);\n      this._raf(this.notifyUpdate);\n    }\n  };\n\n  protected tick(value: number) {\n    this.update(value);\n  }\n\n  public start() {\n    if (this._state === RNSkClockState.NotStarted) {\n      this._start = Date.now();\n      this._stop = this._start;\n    }\n    // Subtract pause time from start\n    const timeSinceStop = Date.now() - this._stop!;\n    this._start! += timeSinceStop;\n\n    this._state = RNSkClockState.Running;\n    this._raf(this.notifyUpdate);\n  }\n\n  public stop() {\n    if (this._state === RNSkClockState.Running) {\n      this._state = RNSkClockState.Stopped;\n      this._stop = Date.now();\n    }\n  }\n}\n"],"mappings":";;;;;;;AAEA;;;;IAEKA,c;;WAAAA,c;EAAAA,c,CAAAA,c;EAAAA,c,CAAAA,c;EAAAA,c,CAAAA,c;GAAAA,c,KAAAA,c;;AAME,MAAMC,cAAN,SACGC,oCADH,CAGP;EACEC,WAAW,CAACC,GAAD,EAAoD;IAC7D,MAAM,CAAN;;IAD6D;;IAAA;;IAAA;;IAAA,gCAS9BJ,cAAc,CAACK,UATe;;IAAA,sCAWvCC,CAAD,IAAe;MACpC,IAAI,KAAKC,MAAL,KAAgBP,cAAc,CAACQ,OAAnC,EAA4C;QAC1C,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAL,EAAZ;QACA,MAAME,cAAc,GAAGF,GAAG,GAAG,KAAKG,MAAlC;QACA,KAAKC,IAAL,CAAUF,cAAV;;QACA,KAAKG,IAAL,CAAU,KAAKC,YAAf;MACD;IACF,CAlB8D;;IAE7D,KAAKD,IAAL,GAAYV,GAAZ;IACA,KAAKY,MAAL,CAAY,CAAZ;EACD;;EAgBSH,IAAI,CAACI,KAAD,EAAgB;IAC5B,KAAKD,MAAL,CAAYC,KAAZ;EACD;;EAEMC,KAAK,GAAG;IACb,IAAI,KAAKX,MAAL,KAAgBP,cAAc,CAACK,UAAnC,EAA+C;MAC7C,KAAKO,MAAL,GAAcF,IAAI,CAACD,GAAL,EAAd;MACA,KAAKU,KAAL,GAAa,KAAKP,MAAlB;IACD,CAJY,CAKb;;;IACA,MAAMQ,aAAa,GAAGV,IAAI,CAACD,GAAL,KAAa,KAAKU,KAAxC;;IACA,KAAKP,MAAL,IAAgBQ,aAAhB;IAEA,KAAKb,MAAL,GAAcP,cAAc,CAACQ,OAA7B;;IACA,KAAKM,IAAL,CAAU,KAAKC,YAAf;EACD;;EAEMM,IAAI,GAAG;IACZ,IAAI,KAAKd,MAAL,KAAgBP,cAAc,CAACQ,OAAnC,EAA4C;MAC1C,KAAKD,MAAL,GAAcP,cAAc,CAACsB,OAA7B;MACA,KAAKH,KAAL,GAAaT,IAAI,CAACD,GAAL,EAAb;IACD;EACF;;AA3CH"}